clear all;


%% Define simulation setup


%Number of Monte Carlo setups

%Number of channel realizations per setup
nbrOfRealizations = 1; %1000;
%Number of APs in the cell-free network
L = 20;

%Number of UEs

K = 6;

%Number of antennas per AP
N = 1;


%Number of pilots per coherence block
tau_p = 20;

%Uplink transmit power per UE (mW)
p = 100;


% fileID3 = fopen('best_vvvver1_endfortoday__1_29_20APs_Single_Path_loss.txt','w');
% fileID4 = fopen('best_vvvver1_endfortoday__1_29_20APs_Single_Path_loss_p2.txt','w');
% fileID3 = fopen('LASTTTTTTTT____20single.txt','w');
% fileID4 = fopen('LASTTTTTTT___20single_p2.txt','w');
% % % % fileID3 = fopen('vvvvvvvvvvvv100m_single_path_loss_25AP_12_13.txt','w');
% % % % fileID4 = fopen('vvvvvvvvvvvv100m_single_path_loss_25AP_12_13_p2.txt','w');

for iiii = 1:101000
    if iiii == 1 %initialize both user and AP positions
        [gainOverNoisedB,R,pilotIndexCF,pilotIndexSC,APpositions,UEpositions] = generateSetup_threeslope_rev_rec_100me(L,K,N,tau_p,1,p);
    else
        %get more realizations using initialized AP and user positions.
         [gainOverNoisedB,R,pilotIndexCF,pilotIndexSC] = generateSetup_threeslope_rev_justuserpos_change22_100me(L,K,N,tau_p,1,p,APpositions,UEpositions); 
    end
        betaVal = db2pow(gainOverNoisedB);
    %Get channel realizations
   [Hhat_AP,H_AP,B_AP] = functionChannelEstimates(R,nbrOfRealizations,L,K,N,tau_p,pilotIndexCF,p);
  
    
if iiii <= 100000% 10000 realizations for training set, 1000 for test set

for jlock = 1:K
    % Write to training set files based on choice of Aps
    
%10 APs    
% fprintf(fileID3,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
%           real(H_AP(1,jlock)), imag(H_AP(1,jlock)),real(H_AP(2,jlock)),imag(H_AP(2,jlock)),real(H_AP(3,jlock)), imag(H_AP(3,jlock)),...
%           real(H_AP(4,jlock)), imag(H_AP(4,jlock)),real(H_AP(5,jlock)),imag(H_AP(5,jlock)),real(H_AP(6,jlock)), imag(H_AP(6,jlock)),...
%           real(H_AP(7,jlock)), imag(H_AP(7,jlock)),real(H_AP(8,jlock)),imag(H_AP(8,jlock)),real(H_AP(9,jlock)), imag(H_AP(9,jlock)),...
%           real(H_AP(10,jlock)), imag(H_AP(10,jlock)));

 % 15 APs
%  fprintf(fileID3,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
%   real(H_AP(1,jlock)), imag(H_AP(1,jlock)),real(H_AP(2,jlock)),imag(H_AP(2,jlock)),real(H_AP(3,jlock)), imag(H_AP(3,jlock)),...
%   real(H_AP(4,jlock)), imag(H_AP(4,jlock)),real(H_AP(5,jlock)),imag(H_AP(5,jlock)),real(H_AP(6,jlock)), imag(H_AP(6,jlock)),...
%   real(H_AP(7,jlock)), imag(H_AP(7,jlock)),real(H_AP(8,jlock)),imag(H_AP(8,jlock)),real(H_AP(9,jlock)), imag(H_AP(9,jlock)),...
%   real(H_AP(10,jlock)), imag(H_AP(10,jlock)),real(H_AP(11,jlock)), imag(H_AP(11,jlock)),real(H_AP(12,jlock)), imag(H_AP(12,jlock)),...
%   real(H_AP(13,jlock)), imag(H_AP(13,jlock)),real(H_AP(14,jlock)), imag(H_AP(14,jlock)),real(H_AP(15,jlock)), imag(H_AP(15,jlock)));  
%      
%       
      
% % % %  20 Aps     
fprintf(fileID3,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_AP(1,jlock)), imag(H_AP(1,jlock)),real(H_AP(2,jlock)),imag(H_AP(2,jlock)),real(H_AP(3,jlock)), imag(H_AP(3,jlock)),...
  real(H_AP(4,jlock)), imag(H_AP(4,jlock)),real(H_AP(5,jlock)),imag(H_AP(5,jlock)),real(H_AP(6,jlock)), imag(H_AP(6,jlock)),...
  real(H_AP(7,jlock)), imag(H_AP(7,jlock)),real(H_AP(8,jlock)),imag(H_AP(8,jlock)),real(H_AP(9,jlock)), imag(H_AP(9,jlock)),...
  real(H_AP(10,jlock)), imag(H_AP(10,jlock)),real(H_AP(11,jlock)), imag(H_AP(11,jlock)),real(H_AP(12,jlock)), imag(H_AP(12,jlock)),...
  real(H_AP(13,jlock)), imag(H_AP(13,jlock)),real(H_AP(14,jlock)), imag(H_AP(14,jlock)),real(H_AP(15,jlock)), imag(H_AP(15,jlock)),...
  real(H_AP(16,jlock)), imag(H_AP(16,jlock)),real(H_AP(17,jlock)), imag(H_AP(17,jlock)),real(H_AP(18,jlock)), imag(H_AP(18,jlock)),...
  real(H_AP(19,jlock)), imag(H_AP(19,jlock)),real(H_AP(20,jlock)), imag(H_AP(20,jlock)));  

%25 APs
% fprintf(fileID3,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
%   real(H_AP(1,jlock)), imag(H_AP(1,jlock)),real(H_AP(2,jlock)),imag(H_AP(2,jlock)),real(H_AP(3,jlock)), imag(H_AP(3,jlock)),...
%   real(H_AP(4,jlock)), imag(H_AP(4,jlock)),real(H_AP(5,jlock)),imag(H_AP(5,jlock)),real(H_AP(6,jlock)), imag(H_AP(6,jlock)),...
%   real(H_AP(7,jlock)), imag(H_AP(7,jlock)),real(H_AP(8,jlock)),imag(H_AP(8,jlock)),real(H_AP(9,jlock)), imag(H_AP(9,jlock)),...
%   real(H_AP(10,jlock)), imag(H_AP(10,jlock)),real(H_AP(11,jlock)), imag(H_AP(11,jlock)),real(H_AP(12,jlock)), imag(H_AP(12,jlock)),...
%   real(H_AP(13,jlock)), imag(H_AP(13,jlock)),real(H_AP(14,jlock)), imag(H_AP(14,jlock)),real(H_AP(15,jlock)), imag(H_AP(15,jlock)),...
%   real(H_AP(16,jlock)), imag(H_AP(16,jlock)),real(H_AP(17,jlock)), imag(H_AP(17,jlock)),real(H_AP(18,jlock)), imag(H_AP(18,jlock)),...
%   real(H_AP(19,jlock)), imag(H_AP(19,jlock)),real(H_AP(20,jlock)), imag(H_AP(20,jlock)),real(H_AP(21,jlock)), imag(H_AP(21,jlock)),... 
%   real(H_AP(22,jlock)), imag(H_AP(22,jlock)),real(H_AP(23,jlock)), imag(H_AP(23,jlock)),real(H_AP(24,jlock)), imag(H_AP(24,jlock)),...
%   real(H_AP(25,jlock)), imag(H_AP(25,jlock)));  


end
      
      
else



for block = 1:K
    %Generating corresponding test set files

    %10 APs
% fprintf(fileID4,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
%           real(H_AP(1,block)), imag(H_AP(1,block)),real(H_AP(2,block)),imag(H_AP(2,block)),real(H_AP(3,block)), imag(H_AP(3,block)),...
%           real(H_AP(4,block)), imag(H_AP(4,block)),real(H_AP(5,block)),imag(H_AP(5,block)),real(H_AP(6,block)), imag(H_AP(6,block)),...
%           real(H_AP(7,block)), imag(H_AP(7,block)),real(H_AP(8,block)),imag(H_AP(8,block)),real(H_AP(9,block)), imag(H_AP(9,block)),...
%           real(H_AP(10,block)), imag(H_AP(10,block)));
%    

%15 Aps
% fprintf(fileID4,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
%           real(H_AP(1,block)), imag(H_AP(1,block)),real(H_AP(2,block)),imag(H_AP(2,block)),real(H_AP(3,block)), imag(H_AP(3,block)),...
%           real(H_AP(4,block)), imag(H_AP(4,block)),real(H_AP(5,block)),imag(H_AP(5,block)),real(H_AP(6,block)), imag(H_AP(6,block)),...
%           real(H_AP(7,block)), imag(H_AP(7,block)),real(H_AP(8,block)),imag(H_AP(8,block)),real(H_AP(9,block)), imag(H_AP(9,block)),...
%           real(H_AP(10,block)), imag(H_AP(10,block)),real(H_AP(11,jlock)), imag(H_AP(11,jlock)),real(H_AP(12,jlock)), imag(H_AP(12,jlock)),...
%           real(H_AP(13,jlock)), imag(H_AP(13,jlock)),real(H_AP(14,jlock)), imag(H_AP(14,jlock)),real(H_AP(15,jlock)), imag(H_AP(15,jlock)));     
%       
%       
      
%20 Aps      
fprintf(fileID4,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
          real(H_AP(1,block)), imag(H_AP(1,block)),real(H_AP(2,block)),imag(H_AP(2,block)),real(H_AP(3,block)), imag(H_AP(3,block)),...
          real(H_AP(4,block)), imag(H_AP(4,block)),real(H_AP(5,block)),imag(H_AP(5,block)),real(H_AP(6,block)), imag(H_AP(6,block)),...
          real(H_AP(7,block)), imag(H_AP(7,block)),real(H_AP(8,block)),imag(H_AP(8,block)),real(H_AP(9,block)), imag(H_AP(9,block)),...
          real(H_AP(10,block)), imag(H_AP(10,block)),real(H_AP(11,block)), imag(H_AP(11,block)),real(H_AP(12,block)), imag(H_AP(12,block)),...
          real(H_AP(13,block)), imag(H_AP(13,block)),real(H_AP(14,block)), imag(H_AP(14,block)),real(H_AP(15,block)), imag(H_AP(15,block)),...
          real(H_AP(16,block)), imag(H_AP(16,block)),real(H_AP(17,block)), imag(H_AP(17,block)),real(H_AP(18,block)), imag(H_AP(18,block)),...
          real(H_AP(19,block)), imag(H_AP(19,block)),real(H_AP(20,block)), imag(H_AP(20,block)));     

% 25 Aps
% fprintf(fileID4,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
%           real(H_AP(1,block)), imag(H_AP(1,block)),real(H_AP(2,block)),imag(H_AP(2,block)),real(H_AP(3,block)), imag(H_AP(3,block)),...
%           real(H_AP(4,block)), imag(H_AP(4,block)),real(H_AP(5,block)),imag(H_AP(5,block)),real(H_AP(6,block)), imag(H_AP(6,block)),...
%           real(H_AP(7,block)), imag(H_AP(7,block)),real(H_AP(8,block)),imag(H_AP(8,block)),real(H_AP(9,block)), imag(H_AP(9,block)),...
%           real(H_AP(10,block)), imag(H_AP(10,block)),real(H_AP(11,block)), imag(H_AP(11,block)),real(H_AP(12,block)), imag(H_AP(12,block)),...
%           real(H_AP(13,block)), imag(H_AP(13,block)),real(H_AP(14,block)), imag(H_AP(14,block)),real(H_AP(15,block)), imag(H_AP(15,block)),...
%           real(H_AP(16,block)), imag(H_AP(16,block)),real(H_AP(17,block)), imag(H_AP(17,block)),real(H_AP(18,block)), imag(H_AP(18,block)),...
%           real(H_AP(19,block)), imag(H_AP(19,block)),real(H_AP(20,block)), imag(H_AP(20,block)),real(H_AP(21,block)), imag(H_AP(21,block)),... 
%           real(H_AP(22,block)), imag(H_AP(22,block)),real(H_AP(23,block)), imag(H_AP(23,block)),real(H_AP(24,block)), imag(H_AP(24,block)),...
%           real(H_AP(25,block)), imag(H_AP(25,block)));     



 
end



end
    
end
fclose(fileID3);
fclose(fileID4);
