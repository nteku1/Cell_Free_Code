clear all;


%% Define simulation setup
%Number of channel realizations per setup
nbrOfRealizations = 1; %1000;
%Number of APs in the cell-free network
L = 25;

%Number of UEs
%K = 2;
%K = 3;
K = 6;

%Number of antennas per AP
N = 1;


%Number of pilots per coherence block
tau_p = 20;

%Uplink transmit power per UE (mW)
p = 100;



% 
% fileID3 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_SIGMAPOINT01_NOISY_ESTIMATE_MMSEE_50000_ver62.txt','w');
% fileID4 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_SIGMAPOINT1_NOISY_ESTIMATE_MMSEE_50000_ver62.txt','w');
% fileID5 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_SIGMA1_NOISY_ESTIMATE_MMSEE_50000_ver62.txt','w');
% fileID6 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_SIGMA2_NOISY_ESTIMATE_MMSEE_50000_ver62.txt','w');
% fileID7 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_SIGMA5_NOISY_ESTIMATE_MMSEE_50000_ver62.txt','w');
% fileID8 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_ACTUAL_NOT_ESTIMATE_MMSEE_50000_ver62.txt','w');
% fileID70 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_ESTIMATE_MMSEE_50000_ver62.txt','w');
% 
% fileID9 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_SIGMAPOINT01_NOISY_ESTIMATE_MMSEE_part2_ver62.txt','w');
% fileID10 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_SIGMAPOINT1_NOISY_ESTIMATE_MMSEE_part2_ver62.txt','w');
% fileID11 = fopen('prepared_ver100000_finallast_last_1_29__25_6_H_SIGMA1_NOISY_ESTIMATE_MMSEE_part2_ver62.txt','w');
% fileID12 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_SIGMA2_NOISY_ESTIMATE_MMSEE_part2_ver62.txt','w');
% fileID13 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_SIGMA5_NOISY_ESTIMATE_MMSEE_part2_ver62.txt','w');
% fileID14 = fopen('prepared_ver100000_finallast_last_1_29_25_6_H_ACTUAL_NOT_ESTIMATE_MMSEE_part2_ver62.txt','w');
% fileID71 = fopen('preapred_ver100000_finallast_last_1_29_25_6_H_ESTIMATE_MMSEE_50000_part2_ver62.txt','w');


for iiii = 1:101000%210000
    if iiii == 1 %initialize both user and AP positions
        [gainOverNoisedB,R,pilotIndexCF,pilotIndexSC,APpositions,UEpositions] = generateSetup_threeslope_rev_rec_100me(L,K,N,tau_p,1,p);
    else
        %get more realizations using initialized AP and user positions.
         [gainOverNoisedB,R,pilotIndexCF,pilotIndexSC] = generateSetup_threeslope_rev_justuserpos_change22_100me(L,K,N,tau_p,1,p,APpositions,UEpositions); 
    end
        betaVal = db2pow(gainOverNoisedB);
        %Get channel realizations
   [Hhat_AP,H_AP,B_AP] = functionChannelEstimates(R,nbrOfRealizations,L,K,N,tau_p,pilotIndexCF,p);
   %Add complex noise at different noise standard deviation levels
    H_noisy_sigma_point01 =  H_AP + (normrnd(0,0.01,25,1,6) + i*normrnd(0,0.01,25,1,6));
    H_noisy_sigma_point1 =  H_AP + (normrnd(0,0.1,25,1,6) + i*normrnd(0,0.1,25,1,6));
    H_noisy_sigma_1 =  H_AP + (normrnd(0,1,25,1,6) + i*normrnd(0,1,25,1,6));
    H_noisy_sigma_2 =  H_AP + (normrnd(0,2,25,1,6)+ i*normrnd(0,2,25,1,6));
    H_noisy_sigma_5 =  H_AP + (normrnd(0,5,25,1,6) + i*normrnd(0,5,25,1,6));


     

    
if iiii <= 100000% 10000 entries in training set, 1000 left in testing set

for jlock = 1:K
% Write to training set files

fprintf(fileID3,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_noisy_sigma_point01(1,jlock)), imag(H_noisy_sigma_point01(1,jlock)),real(H_noisy_sigma_point01(2,jlock)),imag(H_noisy_sigma_point01(2,jlock)),real(H_noisy_sigma_point01(3,jlock)), imag(H_noisy_sigma_point01(3,jlock)),...
  real(H_noisy_sigma_point01(4,jlock)), imag(H_noisy_sigma_point01(4,jlock)),real(H_noisy_sigma_point01(5,jlock)),imag(H_noisy_sigma_point01(5,jlock)),real(H_noisy_sigma_point01(6,jlock)), imag(H_noisy_sigma_point01(6,jlock)),...
  real(H_noisy_sigma_point01(7,jlock)), imag(H_noisy_sigma_point01(7,jlock)),real(H_noisy_sigma_point01(8,jlock)),imag(H_noisy_sigma_point01(8,jlock)),real(H_noisy_sigma_point01(9,jlock)), imag(H_noisy_sigma_point01(9,jlock)),...
  real(H_noisy_sigma_point01(10,jlock)), imag(H_noisy_sigma_point01(10,jlock)),real(H_noisy_sigma_point01(11,jlock)), imag(H_noisy_sigma_point01(11,jlock)),real(H_noisy_sigma_point01(12,jlock)), imag(H_noisy_sigma_point01(12,jlock)),...
  real(H_noisy_sigma_point01(13,jlock)), imag(H_noisy_sigma_point01(13,jlock)),real(H_noisy_sigma_point01(14,jlock)), imag(H_noisy_sigma_point01(14,jlock)),real(H_noisy_sigma_point01(15,jlock)), imag(H_noisy_sigma_point01(15,jlock)),...
  real(H_noisy_sigma_point01(16,jlock)), imag(H_noisy_sigma_point01(16,jlock)),real(H_noisy_sigma_point01(17,jlock)), imag(H_noisy_sigma_point01(17,jlock)),real(H_noisy_sigma_point01(18,jlock)), imag(H_noisy_sigma_point01(18,jlock)),...
  real(H_noisy_sigma_point01(19,jlock)), imag(H_noisy_sigma_point01(19,jlock)),real(H_noisy_sigma_point01(20,jlock)), imag(H_noisy_sigma_point01(20,jlock)),real(H_noisy_sigma_point01(21,jlock)), imag(H_noisy_sigma_point01(21,jlock)),... 
  real(H_noisy_sigma_point01(22,jlock)), imag(H_noisy_sigma_point01(22,jlock)),real(H_noisy_sigma_point01(23,jlock)), imag(H_noisy_sigma_point01(23,jlock)),real(H_noisy_sigma_point01(24,jlock)), imag(H_noisy_sigma_point01(24,jlock)),...
  real(H_noisy_sigma_point01(25,jlock)), imag(H_noisy_sigma_point01(25,jlock)));  

fprintf(fileID4,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_noisy_sigma_point1(1,jlock)), imag(H_noisy_sigma_point1(1,jlock)),real(H_noisy_sigma_point1(2,jlock)),imag(H_noisy_sigma_point1(2,jlock)),real(H_noisy_sigma_point1(3,jlock)), imag(H_noisy_sigma_point1(3,jlock)),...
  real(H_noisy_sigma_point1(4,jlock)), imag(H_noisy_sigma_point1(4,jlock)),real(H_noisy_sigma_point1(5,jlock)),imag(H_noisy_sigma_point1(5,jlock)),real(H_noisy_sigma_point1(6,jlock)), imag(H_noisy_sigma_point1(6,jlock)),...
  real(H_noisy_sigma_point1(7,jlock)), imag(H_noisy_sigma_point1(7,jlock)),real(H_noisy_sigma_point1(8,jlock)),imag(H_noisy_sigma_point1(8,jlock)),real(H_noisy_sigma_point1(9,jlock)), imag(H_noisy_sigma_point1(9,jlock)),...
  real(H_noisy_sigma_point1(10,jlock)), imag(H_noisy_sigma_point1(10,jlock)),real(H_noisy_sigma_point1(11,jlock)), imag(H_noisy_sigma_point1(11,jlock)),real(H_noisy_sigma_point1(12,jlock)), imag(H_noisy_sigma_point1(12,jlock)),...
  real(H_noisy_sigma_point1(13,jlock)), imag(H_noisy_sigma_point1(13,jlock)),real(H_noisy_sigma_point1(14,jlock)), imag(H_noisy_sigma_point1(14,jlock)),real(H_noisy_sigma_point1(15,jlock)), imag(H_noisy_sigma_point1(15,jlock)),...
  real(H_noisy_sigma_point1(16,jlock)), imag(H_noisy_sigma_point1(16,jlock)),real(H_noisy_sigma_point1(17,jlock)), imag(H_noisy_sigma_point1(17,jlock)),real(H_noisy_sigma_point1(18,jlock)), imag(H_noisy_sigma_point1(18,jlock)),...
  real(H_noisy_sigma_point1(19,jlock)), imag(H_noisy_sigma_point1(19,jlock)),real(H_noisy_sigma_point1(20,jlock)), imag(H_noisy_sigma_point1(20,jlock)),real(H_noisy_sigma_point1(21,jlock)), imag(H_noisy_sigma_point1(21,jlock)),... 
  real(H_noisy_sigma_point1(22,jlock)), imag(H_noisy_sigma_point1(22,jlock)),real(H_noisy_sigma_point1(23,jlock)), imag(H_noisy_sigma_point1(23,jlock)),real(H_noisy_sigma_point1(24,jlock)), imag(H_noisy_sigma_point1(24,jlock)),...
  real(H_noisy_sigma_point1(25,jlock)), imag(H_noisy_sigma_point1(25,jlock)));  

fprintf(fileID5,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_noisy_sigma_1(1,jlock)), imag(H_noisy_sigma_1(1,jlock)),real(H_noisy_sigma_1(2,jlock)),imag(H_noisy_sigma_1(2,jlock)),real(H_noisy_sigma_1(3,jlock)), imag(H_noisy_sigma_1(3,jlock)),...
  real(H_noisy_sigma_1(4,jlock)), imag(H_noisy_sigma_1(4,jlock)),real(H_noisy_sigma_1(5,jlock)),imag(H_noisy_sigma_1(5,jlock)),real(H_noisy_sigma_1(6,jlock)), imag(H_noisy_sigma_1(6,jlock)),...
  real(H_noisy_sigma_1(7,jlock)), imag(H_noisy_sigma_1(7,jlock)),real(H_noisy_sigma_1(8,jlock)),imag(H_noisy_sigma_1(8,jlock)),real(H_noisy_sigma_1(9,jlock)), imag(H_noisy_sigma_1(9,jlock)),...
  real(H_noisy_sigma_1(10,jlock)), imag(H_noisy_sigma_1(10,jlock)),real(H_noisy_sigma_1(11,jlock)), imag(H_noisy_sigma_1(11,jlock)),real(H_noisy_sigma_1(12,jlock)), imag(H_noisy_sigma_1(12,jlock)),...
  real(H_noisy_sigma_1(13,jlock)), imag(H_noisy_sigma_1(13,jlock)),real(H_noisy_sigma_1(14,jlock)), imag(H_noisy_sigma_1(14,jlock)),real(H_noisy_sigma_1(15,jlock)), imag(H_noisy_sigma_1(15,jlock)),...
  real(H_noisy_sigma_1(16,jlock)), imag(H_noisy_sigma_1(16,jlock)),real(H_noisy_sigma_1(17,jlock)), imag(H_noisy_sigma_1(17,jlock)),real(H_noisy_sigma_1(18,jlock)), imag(H_noisy_sigma_1(18,jlock)),...
  real(H_noisy_sigma_1(19,jlock)), imag(H_noisy_sigma_1(19,jlock)),real(H_noisy_sigma_1(20,jlock)), imag(H_noisy_sigma_1(20,jlock)),real(H_noisy_sigma_1(21,jlock)), imag(H_noisy_sigma_1(21,jlock)),... 
  real(H_noisy_sigma_1(22,jlock)), imag(H_noisy_sigma_1(22,jlock)),real(H_noisy_sigma_1(23,jlock)), imag(H_noisy_sigma_1(23,jlock)),real(H_noisy_sigma_1(24,jlock)), imag(H_noisy_sigma_1(24,jlock)),...
  real(H_noisy_sigma_1(25,jlock)), imag(H_noisy_sigma_1(25,jlock)));  

fprintf(fileID6,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_noisy_sigma_2(1,jlock)), imag(H_noisy_sigma_2(1,jlock)),real(H_noisy_sigma_2(2,jlock)),imag(H_noisy_sigma_2(2,jlock)),real(H_noisy_sigma_2(3,jlock)), imag(H_noisy_sigma_2(3,jlock)),...
  real(H_noisy_sigma_2(4,jlock)), imag(H_noisy_sigma_2(4,jlock)),real(H_noisy_sigma_2(5,jlock)),imag(H_noisy_sigma_2(5,jlock)),real(H_noisy_sigma_2(6,jlock)), imag(H_noisy_sigma_2(6,jlock)),...
  real(H_noisy_sigma_2(7,jlock)), imag(H_noisy_sigma_2(7,jlock)),real(H_noisy_sigma_2(8,jlock)),imag(H_noisy_sigma_2(8,jlock)),real(H_noisy_sigma_2(9,jlock)), imag(H_noisy_sigma_2(9,jlock)),...
  real(H_noisy_sigma_2(10,jlock)), imag(H_noisy_sigma_2(10,jlock)),real(H_noisy_sigma_2(11,jlock)), imag(H_noisy_sigma_2(11,jlock)),real(H_noisy_sigma_2(12,jlock)), imag(H_noisy_sigma_2(12,jlock)),...
  real(H_noisy_sigma_2(13,jlock)), imag(H_noisy_sigma_2(13,jlock)),real(H_noisy_sigma_2(14,jlock)), imag(H_noisy_sigma_2(14,jlock)),real(H_noisy_sigma_2(15,jlock)), imag(H_noisy_sigma_2(15,jlock)),...
  real(H_noisy_sigma_2(16,jlock)), imag(H_noisy_sigma_2(16,jlock)),real(H_noisy_sigma_2(17,jlock)), imag(H_noisy_sigma_2(17,jlock)),real(H_noisy_sigma_2(18,jlock)), imag(H_noisy_sigma_2(18,jlock)),...
  real(H_noisy_sigma_2(19,jlock)), imag(H_noisy_sigma_2(19,jlock)),real(H_noisy_sigma_2(20,jlock)), imag(H_noisy_sigma_2(20,jlock)),real(H_noisy_sigma_2(21,jlock)), imag(H_noisy_sigma_2(21,jlock)),... 
  real(H_noisy_sigma_2(22,jlock)), imag(H_noisy_sigma_2(22,jlock)),real(H_noisy_sigma_2(23,jlock)), imag(H_noisy_sigma_2(23,jlock)),real(H_noisy_sigma_2(24,jlock)), imag(H_noisy_sigma_2(24,jlock)),...
  real(H_noisy_sigma_2(25,jlock)), imag(H_noisy_sigma_2(25,jlock)));  

fprintf(fileID7,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_noisy_sigma_5(1,jlock)), imag(H_noisy_sigma_5(1,jlock)),real(H_noisy_sigma_5(2,jlock)),imag(H_noisy_sigma_5(2,jlock)),real(H_noisy_sigma_5(3,jlock)), imag(H_noisy_sigma_5(3,jlock)),...
  real(H_noisy_sigma_5(4,jlock)), imag(H_noisy_sigma_5(4,jlock)),real(H_noisy_sigma_5(5,jlock)),imag(H_noisy_sigma_5(5,jlock)),real(H_noisy_sigma_5(6,jlock)), imag(H_noisy_sigma_5(6,jlock)),...
  real(H_noisy_sigma_5(7,jlock)), imag(H_noisy_sigma_5(7,jlock)),real(H_noisy_sigma_5(8,jlock)),imag(H_noisy_sigma_5(8,jlock)),real(H_noisy_sigma_5(9,jlock)), imag(H_noisy_sigma_5(9,jlock)),...
  real(H_noisy_sigma_5(10,jlock)), imag(H_noisy_sigma_5(10,jlock)),real(H_noisy_sigma_5(11,jlock)), imag(H_noisy_sigma_5(11,jlock)),real(H_noisy_sigma_5(12,jlock)), imag(H_noisy_sigma_5(12,jlock)),...
  real(H_noisy_sigma_5(13,jlock)), imag(H_noisy_sigma_5(13,jlock)),real(H_noisy_sigma_5(14,jlock)), imag(H_noisy_sigma_5(14,jlock)),real(H_noisy_sigma_5(15,jlock)), imag(H_noisy_sigma_5(15,jlock)),...
  real(H_noisy_sigma_5(16,jlock)), imag(H_noisy_sigma_5(16,jlock)),real(H_noisy_sigma_5(17,jlock)), imag(H_noisy_sigma_5(17,jlock)),real(H_noisy_sigma_5(18,jlock)), imag(H_noisy_sigma_5(18,jlock)),...
  real(H_noisy_sigma_5(19,jlock)), imag(H_noisy_sigma_5(19,jlock)),real(H_noisy_sigma_5(20,jlock)), imag(H_noisy_sigma_5(20,jlock)),real(H_noisy_sigma_5(21,jlock)), imag(H_noisy_sigma_5(21,jlock)),... 
  real(H_noisy_sigma_5(22,jlock)), imag(H_noisy_sigma_5(22,jlock)),real(H_noisy_sigma_5(23,jlock)), imag(H_noisy_sigma_5(23,jlock)),real(H_noisy_sigma_5(24,jlock)), imag(H_noisy_sigma_5(24,jlock)),...
  real(H_noisy_sigma_5(25,jlock)), imag(H_noisy_sigma_5(25,jlock)));  

fprintf(fileID8,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_AP(1,jlock)), imag(H_AP(1,jlock)),real(H_AP(2,jlock)),imag(H_AP(2,jlock)),real(H_AP(3,jlock)), imag(H_AP(3,jlock)),...
  real(H_AP(4,jlock)), imag(H_AP(4,jlock)),real(H_AP(5,jlock)),imag(H_AP(5,jlock)),real(H_AP(6,jlock)), imag(H_AP(6,jlock)),...
  real(H_AP(7,jlock)), imag(H_AP(7,jlock)),real(H_AP(8,jlock)),imag(H_AP(8,jlock)),real(H_AP(9,jlock)), imag(H_AP(9,jlock)),...
  real(H_AP(10,jlock)), imag(H_AP(10,jlock)),real(H_AP(11,jlock)), imag(H_AP(11,jlock)),real(H_AP(12,jlock)), imag(H_AP(12,jlock)),...
  real(H_AP(13,jlock)), imag(H_AP(13,jlock)),real(H_AP(14,jlock)), imag(H_AP(14,jlock)),real(H_AP(15,jlock)), imag(H_AP(15,jlock)),...
  real(H_AP(16,jlock)), imag(H_AP(16,jlock)),real(H_AP(17,jlock)), imag(H_AP(17,jlock)),real(H_AP(18,jlock)), imag(H_AP(18,jlock)),...
  real(H_AP(19,jlock)), imag(H_AP(19,jlock)),real(H_AP(20,jlock)), imag(H_AP(20,jlock)),real(H_AP(21,jlock)), imag(H_AP(21,jlock)),... 
  real(H_AP(22,jlock)), imag(H_AP(22,jlock)),real(H_AP(23,jlock)), imag(H_AP(23,jlock)),real(H_AP(24,jlock)), imag(H_AP(24,jlock)),...
  real(H_AP(25,jlock)), imag(H_AP(25,jlock)));  



fprintf(fileID70,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(Hhat_AP(1,jlock)), imag(Hhat_AP(1,jlock)),real(Hhat_AP(2,jlock)),imag(Hhat_AP(2,jlock)),real(Hhat_AP(3,jlock)), imag(Hhat_AP(3,jlock)),...
  real(Hhat_AP(4,jlock)), imag(Hhat_AP(4,jlock)),real(Hhat_AP(5,jlock)),imag(Hhat_AP(5,jlock)),real(Hhat_AP(6,jlock)), imag(Hhat_AP(6,jlock)),...
  real(Hhat_AP(7,jlock)), imag(Hhat_AP(7,jlock)),real(Hhat_AP(8,jlock)),imag(Hhat_AP(8,jlock)),real(Hhat_AP(9,jlock)), imag(Hhat_AP(9,jlock)),...
  real(Hhat_AP(10,jlock)), imag(Hhat_AP(10,jlock)),real(Hhat_AP(11,jlock)), imag(Hhat_AP(11,jlock)),real(Hhat_AP(12,jlock)), imag(Hhat_AP(12,jlock)),...
  real(Hhat_AP(13,jlock)), imag(Hhat_AP(13,jlock)),real(Hhat_AP(14,jlock)), imag(Hhat_AP(14,jlock)),real(Hhat_AP(15,jlock)), imag(Hhat_AP(15,jlock)),...
  real(Hhat_AP(16,jlock)), imag(Hhat_AP(16,jlock)),real(Hhat_AP(17,jlock)), imag(Hhat_AP(17,jlock)),real(Hhat_AP(18,jlock)), imag(Hhat_AP(18,jlock)),...
  real(Hhat_AP(19,jlock)), imag(Hhat_AP(19,jlock)),real(Hhat_AP(20,jlock)), imag(Hhat_AP(20,jlock)),real(Hhat_AP(21,jlock)), imag(Hhat_AP(21,jlock)),... 
  real(Hhat_AP(22,jlock)), imag(Hhat_AP(22,jlock)),real(Hhat_AP(23,jlock)), imag(Hhat_AP(23,jlock)),real(Hhat_AP(24,jlock)), imag(Hhat_AP(24,jlock)),...
  real(Hhat_AP(25,jlock)), imag(Hhat_AP(25,jlock)));

end
      
      
else


for block = 1:K

% % % Generating corresponding test set files
fprintf(fileID9,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_noisy_sigma_point01(1,block)), imag(H_noisy_sigma_point01(1,block)),real(H_noisy_sigma_point01(2,block)),imag(H_noisy_sigma_point01(2,block)),real(H_noisy_sigma_point01(3,block)), imag(H_noisy_sigma_point01(3,block)),...
  real(H_noisy_sigma_point01(4,block)), imag(H_noisy_sigma_point01(4,block)),real(H_noisy_sigma_point01(5,block)),imag(H_noisy_sigma_point01(5,block)),real(H_noisy_sigma_point01(6,block)), imag(H_noisy_sigma_point01(6,block)),...
  real(H_noisy_sigma_point01(7,block)), imag(H_noisy_sigma_point01(7,block)),real(H_noisy_sigma_point01(8,block)),imag(H_noisy_sigma_point01(8,block)),real(H_noisy_sigma_point01(9,block)), imag(H_noisy_sigma_point01(9,block)),...
  real(H_noisy_sigma_point01(10,block)), imag(H_noisy_sigma_point01(10,block)),real(H_noisy_sigma_point01(11,block)), imag(H_noisy_sigma_point01(11,block)),real(H_noisy_sigma_point01(12,block)), imag(H_noisy_sigma_point01(12,block)),...
  real(H_noisy_sigma_point01(13,block)), imag(H_noisy_sigma_point01(13,block)),real(H_noisy_sigma_point01(14,block)), imag(H_noisy_sigma_point01(14,block)),real(H_noisy_sigma_point01(15,block)), imag(H_noisy_sigma_point01(15,block)),...
  real(H_noisy_sigma_point01(16,block)), imag(H_noisy_sigma_point01(16,block)),real(H_noisy_sigma_point01(17,block)), imag(H_noisy_sigma_point01(17,block)),real(H_noisy_sigma_point01(18,block)), imag(H_noisy_sigma_point01(18,block)),...
  real(H_noisy_sigma_point01(19,block)), imag(H_noisy_sigma_point01(19,block)),real(H_noisy_sigma_point01(20,block)), imag(H_noisy_sigma_point01(20,block)),real(H_noisy_sigma_point01(21,block)), imag(H_noisy_sigma_point01(21,block)),... 
  real(H_noisy_sigma_point01(22,block)), imag(H_noisy_sigma_point01(22,block)),real(H_noisy_sigma_point01(23,block)), imag(H_noisy_sigma_point01(23,block)),real(H_noisy_sigma_point01(24,block)), imag(H_noisy_sigma_point01(24,block)),...
  real(H_noisy_sigma_point01(25,block)), imag(H_noisy_sigma_point01(25,block)));  

fprintf(fileID10,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_noisy_sigma_point1(1,block)), imag(H_noisy_sigma_point1(1,block)),real(H_noisy_sigma_point1(2,block)),imag(H_noisy_sigma_point1(2,block)),real(H_noisy_sigma_point1(3,block)), imag(H_noisy_sigma_point1(3,block)),...
  real(H_noisy_sigma_point1(4,block)), imag(H_noisy_sigma_point1(4,block)),real(H_noisy_sigma_point1(5,block)),imag(H_noisy_sigma_point1(5,block)),real(H_noisy_sigma_point1(6,block)), imag(H_noisy_sigma_point1(6,block)),...
  real(H_noisy_sigma_point1(7,block)), imag(H_noisy_sigma_point1(7,block)),real(H_noisy_sigma_point1(8,block)),imag(H_noisy_sigma_point1(8,block)),real(H_noisy_sigma_point1(9,block)), imag(H_noisy_sigma_point1(9,block)),...
  real(H_noisy_sigma_point1(10,block)), imag(H_noisy_sigma_point1(10,block)),real(H_noisy_sigma_point1(11,block)), imag(H_noisy_sigma_point1(11,block)),real(H_noisy_sigma_point1(12,block)), imag(H_noisy_sigma_point1(12,block)),...
  real(H_noisy_sigma_point1(13,block)), imag(H_noisy_sigma_point1(13,block)),real(H_noisy_sigma_point1(14,block)), imag(H_noisy_sigma_point1(14,block)),real(H_noisy_sigma_point1(15,block)), imag(H_noisy_sigma_point1(15,block)),...
  real(H_noisy_sigma_point1(16,block)), imag(H_noisy_sigma_point1(16,block)),real(H_noisy_sigma_point1(17,block)), imag(H_noisy_sigma_point1(17,block)),real(H_noisy_sigma_point1(18,block)), imag(H_noisy_sigma_point1(18,block)),...
  real(H_noisy_sigma_point1(19,block)), imag(H_noisy_sigma_point1(19,block)),real(H_noisy_sigma_point1(20,block)), imag(H_noisy_sigma_point1(20,block)),real(H_noisy_sigma_point1(21,block)), imag(H_noisy_sigma_point1(21,block)),... 
  real(H_noisy_sigma_point1(22,block)), imag(H_noisy_sigma_point1(22,block)),real(H_noisy_sigma_point1(23,block)), imag(H_noisy_sigma_point1(23,block)),real(H_noisy_sigma_point1(24,block)), imag(H_noisy_sigma_point1(24,block)),...
  real(H_noisy_sigma_point1(25,block)), imag(H_noisy_sigma_point1(25,block)));  




fprintf(fileID11,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_noisy_sigma_1(1,block)), imag(H_noisy_sigma_1(1,block)),real(H_noisy_sigma_1(2,block)),imag(H_noisy_sigma_1(2,block)),real(H_noisy_sigma_1(3,block)), imag(H_noisy_sigma_1(3,block)),...
  real(H_noisy_sigma_1(4,block)), imag(H_noisy_sigma_1(4,block)),real(H_noisy_sigma_1(5,block)),imag(H_noisy_sigma_1(5,block)),real(H_noisy_sigma_1(6,block)), imag(H_noisy_sigma_1(6,block)),...
  real(H_noisy_sigma_1(7,block)), imag(H_noisy_sigma_1(7,block)),real(H_noisy_sigma_1(8,block)),imag(H_noisy_sigma_1(8,block)),real(H_noisy_sigma_1(9,block)), imag(H_noisy_sigma_1(9,block)),...
  real(H_noisy_sigma_1(10,block)), imag(H_noisy_sigma_1(10,block)),real(H_noisy_sigma_1(11,block)), imag(H_noisy_sigma_1(11,block)),real(H_noisy_sigma_1(12,block)), imag(H_noisy_sigma_1(12,block)),...
  real(H_noisy_sigma_1(13,block)), imag(H_noisy_sigma_1(13,block)),real(H_noisy_sigma_1(14,block)), imag(H_noisy_sigma_1(14,block)),real(H_noisy_sigma_1(15,block)), imag(H_noisy_sigma_1(15,block)),...
  real(H_noisy_sigma_1(16,block)), imag(H_noisy_sigma_1(16,block)),real(H_noisy_sigma_1(17,block)), imag(H_noisy_sigma_1(17,block)),real(H_noisy_sigma_1(18,block)), imag(H_noisy_sigma_1(18,block)),...
  real(H_noisy_sigma_1(19,block)), imag(H_noisy_sigma_1(19,block)),real(H_noisy_sigma_1(20,block)), imag(H_noisy_sigma_1(20,block)),real(H_noisy_sigma_1(21,block)), imag(H_noisy_sigma_1(21,block)),... 
  real(H_noisy_sigma_1(22,block)), imag(H_noisy_sigma_1(22,block)),real(H_noisy_sigma_1(23,block)), imag(H_noisy_sigma_1(23,block)),real(H_noisy_sigma_1(24,block)), imag(H_noisy_sigma_1(24,block)),...
  real(H_noisy_sigma_1(25,block)), imag(H_noisy_sigma_1(25,block)));  

fprintf(fileID12,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_noisy_sigma_2(1,block)), imag(H_noisy_sigma_2(1,block)),real(H_noisy_sigma_2(2,block)),imag(H_noisy_sigma_2(2,block)),real(H_noisy_sigma_2(3,block)), imag(H_noisy_sigma_2(3,block)),...
  real(H_noisy_sigma_2(4,block)), imag(H_noisy_sigma_2(4,block)),real(H_noisy_sigma_2(5,block)),imag(H_noisy_sigma_2(5,block)),real(H_noisy_sigma_2(6,block)), imag(H_noisy_sigma_2(6,block)),...
  real(H_noisy_sigma_2(7,block)), imag(H_noisy_sigma_2(7,block)),real(H_noisy_sigma_2(8,block)),imag(H_noisy_sigma_2(8,block)),real(H_noisy_sigma_2(9,block)), imag(H_noisy_sigma_2(9,block)),...
  real(H_noisy_sigma_2(10,block)), imag(H_noisy_sigma_2(10,block)),real(H_noisy_sigma_2(11,block)), imag(H_noisy_sigma_2(11,block)),real(H_noisy_sigma_2(12,block)), imag(H_noisy_sigma_2(12,block)),...
  real(H_noisy_sigma_2(13,block)), imag(H_noisy_sigma_2(13,block)),real(H_noisy_sigma_2(14,block)), imag(H_noisy_sigma_2(14,block)),real(H_noisy_sigma_2(15,block)), imag(H_noisy_sigma_2(15,block)),...
  real(H_noisy_sigma_2(16,block)), imag(H_noisy_sigma_2(16,block)),real(H_noisy_sigma_2(17,block)), imag(H_noisy_sigma_2(17,block)),real(H_noisy_sigma_2(18,block)), imag(H_noisy_sigma_2(18,block)),...
  real(H_noisy_sigma_2(19,block)), imag(H_noisy_sigma_2(19,block)),real(H_noisy_sigma_2(20,block)), imag(H_noisy_sigma_2(20,block)),real(H_noisy_sigma_2(21,block)), imag(H_noisy_sigma_2(21,block)),... 
  real(H_noisy_sigma_2(22,block)), imag(H_noisy_sigma_2(22,block)),real(H_noisy_sigma_2(23,block)), imag(H_noisy_sigma_2(23,block)),real(H_noisy_sigma_2(24,block)), imag(H_noisy_sigma_2(24,block)),...
  real(H_noisy_sigma_2(25,block)), imag(H_noisy_sigma_2(25,block)));  

fprintf(fileID13,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
  real(H_noisy_sigma_5(1,block)), imag(H_noisy_sigma_5(1,block)),real(H_noisy_sigma_5(2,block)),imag(H_noisy_sigma_5(2,block)),real(H_noisy_sigma_5(3,block)), imag(H_noisy_sigma_5(3,block)),...
  real(H_noisy_sigma_5(4,block)), imag(H_noisy_sigma_5(4,block)),real(H_noisy_sigma_5(5,block)),imag(H_noisy_sigma_5(5,block)),real(H_noisy_sigma_5(6,block)), imag(H_noisy_sigma_5(6,block)),...
  real(H_noisy_sigma_5(7,block)), imag(H_noisy_sigma_5(7,block)),real(H_noisy_sigma_5(8,block)),imag(H_noisy_sigma_5(8,block)),real(H_noisy_sigma_5(9,block)), imag(H_noisy_sigma_5(9,block)),...
  real(H_noisy_sigma_5(10,block)), imag(H_noisy_sigma_5(10,block)),real(H_noisy_sigma_5(11,block)), imag(H_noisy_sigma_5(11,block)),real(H_noisy_sigma_5(12,block)), imag(H_noisy_sigma_5(12,block)),...
  real(H_noisy_sigma_5(13,block)), imag(H_noisy_sigma_5(13,block)),real(H_noisy_sigma_5(14,block)), imag(H_noisy_sigma_5(14,block)),real(H_noisy_sigma_5(15,block)), imag(H_noisy_sigma_5(15,block)),...
  real(H_noisy_sigma_5(16,block)), imag(H_noisy_sigma_5(16,block)),real(H_noisy_sigma_5(17,block)), imag(H_noisy_sigma_5(17,block)),real(H_noisy_sigma_5(18,block)), imag(H_noisy_sigma_5(18,block)),...
  real(H_noisy_sigma_5(19,block)), imag(H_noisy_sigma_5(19,block)),real(H_noisy_sigma_5(20,block)), imag(H_noisy_sigma_5(20,block)),real(H_noisy_sigma_5(21,block)), imag(H_noisy_sigma_5(21,block)),... 
  real(H_noisy_sigma_5(22,block)), imag(H_noisy_sigma_5(22,block)),real(H_noisy_sigma_5(23,block)), imag(H_noisy_sigma_5(23,block)),real(H_noisy_sigma_5(24,block)), imag(H_noisy_sigma_5(24,block)),...
  real(H_noisy_sigma_5(25,block)), imag(H_noisy_sigma_5(25,block)));  
      
 
fprintf(fileID14,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
          real(H_AP(1,block)), imag(H_AP(1,block)),real(H_AP(2,block)),imag(H_AP(2,block)),real(H_AP(3,block)), imag(H_AP(3,block)),...
          real(H_AP(4,block)), imag(H_AP(4,block)),real(H_AP(5,block)),imag(H_AP(5,block)),real(H_AP(6,block)), imag(H_AP(6,block)),...
          real(H_AP(7,block)), imag(H_AP(7,block)),real(H_AP(8,block)),imag(H_AP(8,block)),real(H_AP(9,block)), imag(H_AP(9,block)),...
          real(H_AP(10,block)), imag(H_AP(10,block)),real(H_AP(11,block)), imag(H_AP(11,block)),real(H_AP(12,block)), imag(H_AP(12,block)),...
          real(H_AP(13,block)), imag(H_AP(13,block)),real(H_AP(14,block)), imag(H_AP(14,block)),real(H_AP(15,block)), imag(H_AP(15,block)),...
          real(H_AP(16,block)), imag(H_AP(16,block)),real(H_AP(17,block)), imag(H_AP(17,block)),real(H_AP(18,block)), imag(H_AP(18,block)),...
          real(H_AP(19,block)), imag(H_AP(19,block)),real(H_AP(20,block)), imag(H_AP(20,block)),real(H_AP(21,block)), imag(H_AP(21,block)),... 
          real(H_AP(22,block)), imag(H_AP(22,block)),real(H_AP(23,block)), imag(H_AP(23,block)),real(H_AP(24,block)), imag(H_AP(24,block)),...
          real(H_AP(25,block)), imag(H_AP(25,block)));  
      

fprintf(fileID71,'%.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f %.5f\n',...
          real(Hhat_AP(1,block)), imag(Hhat_AP(1,block)),real(Hhat_AP(2,block)),imag(Hhat_AP(2,block)),real(Hhat_AP(3,block)), imag(Hhat_AP(3,block)),...
          real(Hhat_AP(4,block)), imag(Hhat_AP(4,block)),real(Hhat_AP(5,block)),imag(Hhat_AP(5,block)),real(Hhat_AP(6,block)), imag(Hhat_AP(6,block)),...
          real(Hhat_AP(7,block)), imag(Hhat_AP(7,block)),real(Hhat_AP(8,block)),imag(Hhat_AP(8,block)),real(Hhat_AP(9,block)), imag(Hhat_AP(9,block)),...
          real(Hhat_AP(10,block)), imag(Hhat_AP(10,block)),real(Hhat_AP(11,block)), imag(Hhat_AP(11,block)),real(Hhat_AP(12,block)), imag(Hhat_AP(12,block)),...
          real(Hhat_AP(13,block)), imag(Hhat_AP(13,block)),real(Hhat_AP(14,block)), imag(Hhat_AP(14,block)),real(Hhat_AP(15,block)), imag(Hhat_AP(15,block)),...
          real(Hhat_AP(16,block)), imag(Hhat_AP(16,block)),real(Hhat_AP(17,block)), imag(Hhat_AP(17,block)),real(Hhat_AP(18,block)), imag(Hhat_AP(18,block)),...
          real(Hhat_AP(19,block)), imag(Hhat_AP(19,block)),real(Hhat_AP(20,block)), imag(Hhat_AP(20,block)),real(Hhat_AP(21,block)), imag(Hhat_AP(21,block)),... 
          real(Hhat_AP(22,block)), imag(Hhat_AP(22,block)),real(Hhat_AP(23,block)), imag(Hhat_AP(23,block)),real(Hhat_AP(24,block)), imag(Hhat_AP(24,block)),...
          real(Hhat_AP(25,block)), imag(Hhat_AP(25,block)));  


 
end



end
    
end
fclose(fileID3);
fclose(fileID4);
fclose(fileID5);
fclose(fileID6);
fclose(fileID7);
fclose(fileID8);
fclose(fileID9);
fclose(fileID10);
fclose(fileID11);
fclose(fileID12);
fclose(fileID13);
fclose(fileID14);

